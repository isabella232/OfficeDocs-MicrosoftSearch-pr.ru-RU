---
title: Соедините Graph ServiceNow для поиска в Microsoft Search
ms.author: mecampos
author: mecampos
manager: umas
audience: Admin
ms.audience: Admin
ms.topic: article
ms.service: mssearch
localization_priority: Normal
search.appverid:
- BFB160
- MET150
- MOE150
description: Настройка соединитетеля ServiceNow Graph microsoft Search
ms.openlocfilehash: ac5d0b23547ce7ccd0d8bb6399b092f9bc9e5303
ms.sourcegitcommit: f12e7ff0a94d30a9de1f93266715180e7530de3f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/10/2021
ms.locfileid: "52879311"
---
<!---Previous ms.author: kam1 --->


# <a name="servicenow-graph-connector"></a>Соединители serviceNow Graph

С помощью Graph Microsoft для ServiceNow ваша организация может индексировать статьи на основе знаний, которые видны всем пользователям или ограничены разрешениями на использование критериев пользователей в организации. После настройки соединители и индексации контента из ServiceNow конечные пользователи могут искать эти статьи из любого клиента Microsoft Search.  

В этой статье Microsoft 365 администраторы или все, кто настраивает, запускает и отслеживает соединители ServiceNow Graph. Он дополняет общие инструкции, предусмотренные в статье [Настройка Graph соединители.](configure-connector.md) Если вы еще этого не сделали, ознакомьтесь со всей статьей Настройка Graph Connector, чтобы понять общий процесс настройки.

Каждый шаг в процессе установки указан ниже вместе с примечанием, которое указывает на то, что следует выполнять общие инструкции установки или [](#troubleshooting) другие инструкции, применимые только к соединителу ServiceNow Graph, включая сведения о устранении неполадок и ограничениях. [](#limitations)  

## <a name="step-1-add-a-graph-connector-in-the-microsoft-365-admin-center"></a>Шаг 1. Добавьте соединителю Graph в Microsoft 365 центре администрирования.
Следуйте общим инструкциям установки.

## <a name="step-2-name-the-connection"></a>Шаг 2. Имя подключения.
Следуйте общим инструкциям установки.


## <a name="step-3-connection-settings"></a>Шаг 3. Подключение Параметры
Чтобы подключиться к данным ServiceNow, необходимо URL-адрес экземпляра **ServiceNow вашей организации.** URL-адрес экземпляра ServiceNow организации обычно https:// домена вашей организации **&lt;>.service-now.com.** 

Наряду с этим URL-адресом вам потребуется учетная запись службы для настройки подключения к ServiceNow, а также для того, чтобы разрешить Microsoft Search периодически обновлять статьи знаний в соответствии с расписанием обновления.  Учетной записи службы потребуется прочитать доступ к следующим записям **таблицы ServiceNow** для успешного обхода различных сущностями.

**Функция** | **Чтение таблиц, необходимых для доступа** | **Описание**
--- | --- | ---
Статьи об индексации знаний, доступные <em>каждому</em> | kb_knowledge | Для обхода статей знаний
Индексация и поддержка разрешений на использование критериев пользователей | kb_uc_can_read_mtom | Кто может прочитать эту базу знаний
| | kb_uc_can_contribute_mtom | Кто может внести свой вклад в эту базу знаний
| | kb_uc_cannot_read_mtom | Кто не может прочитать эту базу знаний
| | kb_uc_cannot_contribute_mtom | Кто не может внести свой вклад в эту базу знаний
| | sys_user | Чтение таблицы пользователей
| | sys_user_has_role | Чтение сведений о роли пользователей
| | sys_user_grmember | Чтение членства пользователей в группах
| | user_criteria | Read user criteria permissions
| | kb_knowledge_base | Чтение сведений о базе знаний

Вы можете **создать и назначить роль для** учетной записи службы, используемой для подключения к Microsoft Search. [Узнайте, как назначить роль для учетных записей ServiceNow.](https://docs.servicenow.com/bundle/paris-platform-administration/page/administer/users-and-groups/task/t_AssignARoleToAUser.html) Чтение доступа к таблицам может быть назначено на созданную роль. Подробнее об установке доступа к записям таблицы для чтения см. в материале [Securing Table Records.](https://developer.servicenow.com/dev.do#!/learn/learning-plans/orlando/new_to_servicenow/app_store_learnv2_securingapps_orlando_creating_and_editing_access_controls) 


>[!NOTE]
> ServiceNow Graph Connector может индексировать статьи знаний и разрешения на критерии пользователей без расширенных скриптов. Если критерии пользователя содержат расширенный скрипт, все связанные статьи знаний будут скрыты от результатов поиска.

Чтобы проверить подлинность и синхронизировать контент из ServiceNow, выберите **один из трех** поддерживаемых методов: 
 
- Обычная проверка подлинности 
- ServiceNow OAuth (рекомендуется)
- Azure AD OpenID Подключение

## <a name="step-31-basic-authentication"></a>Шаг 3.1. Базовая проверка подлинности

Введите имя пользователя и пароль учетной  записи ServiceNow с ролью знаний для проверки подлинности экземпляра.

## <a name="step-32-servicenow-oauth"></a>Шаг 3.2. ServiceNow OAuth

Чтобы использовать ServiceNow OAuth для проверки подлинности, администратору ServiceNow необходимо в экземпляре ServiceNow задать конечную точку, чтобы приложение Microsoft Search стало получать к нему доступ. Дополнительные дополнительные возможности см. в [статью Создание конечной точки](https://docs.servicenow.com/bundle/newyork-platform-administration/page/administer/security/task/t_CreateEndpointforExternalClients.html) для доступа клиентов к экземпляру в документации ServiceNow.

В следующей таблице приводится руководство по заполняемой форме создания конечной точки:

Поле | Описание | Рекомендуемое значение 
--- | --- | ---
Имя | Уникальное значение, которое определяет приложение, для которое требуется доступ к OAuth. | Поиск (Майкрософт)
Идентификатор клиента | Уникальный ID, созданный только для чтения, для приложения. Экземпляр использует клиентский ID при запросе маркера доступа. | Н/Д
Секрет клиента | С помощью этой общей секретной строки экземпляр ServiceNow и Microsoft Search разрешают сообщения друг с другом. | Следуйте лучшим практикам безопасности, обращаясь с секретом как с паролем.
URL-адрес перенаправления | Необходимый URL-адрес вызова, на который перенаправляется сервер авторизации. | https://gcs.office.com/v1.0/admin/oauth/callback
URL-адрес логотипа | URL-адрес, содержащий изображение для логотипа приложения. | Н/Д
Активация | Выберите контрольный ящик, чтобы сделать реестр приложений активным. | Настройка активного
Обновление срока службы маркера | Количество секунд, которые допустимы для маркера обновления. По умолчанию срок действия маркеров обновления истекает через 100 дней (8 640 000 секунд). | 31 536 000 (1 год)
Срок службы маркера доступа | Количество секунд, которые допустимы для маркера доступа. | 43 200 (12 часов)

Введите id клиента и секрет клиента, чтобы подключиться к экземпляру. После подключения используйте учетные данные учетной записи ServiceNow для проверки подлинности разрешения для обхода. Учетная запись должна, по крайней мере, иметь **роль знаний.** Обратитесь к таблице в начале шага [3:](#step-3-connection-settings) параметры подключения для предоставления доступа к дополнительным записям таблицы ServiceNow и разрешениям на индексацию критериев пользователей.

## <a name="step-33-azure-ad-openid-connect"></a>Шаг 3.3: Azure AD OpenID Подключение

Чтобы использовать службу OpenID Azure AD Подключение проверки подлинности, выполните следующие действия.

### <a name="step-331-register-a-new-application-in-azure-active-directory"></a>Шаг 3.3.1. Регистрация нового приложения в Azure Active Directory

Подробнее о регистрации нового приложения в Azure Active Directory см. в [статью Регистрация приложения.](/azure/active-directory/develop/quickstart-register-app#register-an-application) Выберите единый организационный каталог клиента. Перенаправление URI не требуется. После регистрации обратите внимание на ID приложения (клиента) и directory (tenant).

### <a name="step-332-create-a-client-secret"></a>Шаг 3.3.2. Создание секрета клиента

Дополнительные информацию о создании клиентской тайны см. в [см. в "Создание секрета клиента".](/azure/active-directory/develop/quickstart-register-app#add-a-client-secret) Обратите внимание на секрет клиента.

### <a name="step-333-retrieve-service-principal-object-identifier"></a>Шаг 3.3.3. Извлечение идентификатора основного объекта службы

Выполните действия по извлечению идентификатора основного объекта службы

1. Запустите PowerShell.

2. Установите Azure PowerShell с помощью следующей команды.

   ```powershell
   Install-Module -Name Az -AllowClobber -Scope CurrentUser
   ```

3. Подключение Azure.

   ```powershell
   Connect-AzAccount
   ```

4. Получите идентификатор основного объекта службы.

   ```powershell
   Get-AzADServicePrincipal -ApplicationId "Application-ID"
   ```
   Замените "Application-ID" на ID приложения (клиента) (без кавычка) приложения, зарегистрированного на шаге 3.a. Обратите внимание на значение ID-объекта из вывода PowerShell. Это главный ID службы.

Теперь у вас есть все сведения, необходимые на портале Azure. Краткое описание сведений приведено в таблице ниже.

Свойство | Описание 
--- | ---
Directory ID (Tenant ID) | Уникальный ID клиента Azure Active Directory с шага 3.a.
ID приложения (Client ID) | Уникальный ID приложения, зарегистрированного в шаге 3.a.
Секрет клиента | Секретный ключ приложения (от шага 3.b). Обращайся с ним как с паролем.
ID директора службы | Удостоверение для приложения, запущенного в качестве службы. (с шага 3.c)

### <a name="step-334-register-servicenow-application"></a>Шаг 3.3.4. Приложение Register ServiceNow

Экземпляр ServiceNow нуждается в следующей конфигурации:

1. Регистрация нового объекта OAuth OIDC. Дополнительные возможности см. [в статью Создание поставщика OAuth OIDC.](https://docs.servicenow.com/bundle/orlando-platform-administration/page/administer/security/task/add-OIDC-entity.html)

2. В следующей таблице указаны инструкции по заполняемой форме регистрации поставщика OIDC

   Поле | Описание | Рекомендуемое значение
   --- | --- | ---
   Имя | Уникальное имя, идентифицирует сущность OAuth OIDC. | Azure AD
   Идентификатор клиента | ID клиента приложения, зарегистрированного на стороннем сервере OAuth OIDC. Экземпляр использует клиентский ID при запросе маркера доступа. | ID приложения (клиента) с шага 3.a
   Секрет клиента | Секрет клиента приложения, зарегистрированного на стороннем сервере OAuth OIDC. | Секрет клиента с шага 3.b

   Все остальные значения могут быть по умолчанию.

3. В форме регистрации поставщика OIDC необходимо добавить новую конфигурацию поставщика OIDC. Выберите значок поиска в поле *конфигурации поставщика OAuth OIDC,* чтобы открыть записи конфигураций OIDC. Выберите New.

4. В следующей таблице приводится руководство по заполняемой форме конфигурации поставщика OIDC

   Поле | Рекомендуемое значение
   --- | ---
   Поставщик OIDC |  Azure AD
   URL-адрес метаданных OIDC | URL-адрес должен быть в форме \: https//login.microsoftonline.com/<tenandId">/.well-known/openid-configuration <br/>Замените "tenantID" на directory (tenant) ID с шага 3.a.
   Срок службы кэша конфигурации OIDC |  120
   Для приложений | Глобальная
   Утверждение пользователя | sub
   Пользовательское поле | Идентификатор пользователя
   Включить проверку утверждений JTI | Отключено

5. Выберите отправку и обновление формы OAuth OIDC Entity.

### <a name="step-335-create-a-servicenow-account"></a>Шаг 3.3.5. Создание учетной записи ServiceNow

Обратитесь к инструкциям по созданию учетной записи ServiceNow, [созданию пользователя в ServiceNow](https://docs.servicenow.com/bundle/paris-platform-administration/page/administer/users-and-groups/task/t_CreateAUser.html).

В следующей таблице указаны инструкции по заполняемой регистрации учетной записи пользователя ServiceNow

Поле | Рекомендуемое значение
--- | ---
Идентификатор пользователя | ID директора службы с шага 3.c
Доступ только к веб-службам | Checked

Все остальные значения можно оставить по умолчанию.

### <a name="step-336-enable-knowledge-role-for-the-servicenow-account"></a>Шаг 3.3.6. Включить роль знания для учетной записи ServiceNow

Доступ к учетной записи ServiceNow, созданной с главным ИД ServiceNow в качестве пользовательского ИД, и назначьте роль знаний. Инструкции по назначению роли учетной записи ServiceNow можно найти здесь, назначив роль [пользователю.](https://docs.servicenow.com/bundle/paris-platform-administration/page/administer/users-and-groups/task/t_AssignARoleToAUser.html) Обратитесь к таблице в начале шага [3:](#step-3-connection-settings) параметры подключения для предоставления доступа к дополнительным записям таблицы ServiceNow и разрешениям на индексацию критериев пользователей.

Используйте ID приложения в качестве client ID (с шага 3.a) и client secret (с шага 3.b) в мастере конфигурации центра администрирования для проверки подлинности экземпляра ServiceNow с помощью azure AD OpenID Подключение.

## <a name="step-4-select-properties-and-filter-data"></a>Шаг 4. Выбор свойств и фильтрация данных

На этом шаге можно добавить или удалить доступные свойства из источника данных ServiceNow. Microsoft 365 уже выбрано несколько свойств по умолчанию.

Со строкой запроса ServiceNow можно указать условия синхронизации статей. Это как клаузула **Where** в **заявлении SQL Select.** Например, можно индексировать только опубликованные и активные статьи. Чтобы узнать о создании собственной строки запроса, см. в статью Создание строки закодированного запроса [с помощью фильтра.](https://docs.servicenow.com/bundle/paris-platform-user-interface/page/use/using-lists/task/t_GenEncodQueryStringFilter.html)

Чтобы проверить пример значений выбранных свойств и фильтра запросов, используйте кнопку "Результаты предварительного просмотра".

## <a name="step-5-manage-search-permissions"></a>Шаг 5. Управление разрешениями на поиск

Соединители ServiceNow поддерживают разрешения на  поиск, видимые всем или только людям с доступом **к этому источнику данных.** Индексные данные появляются в результатах поиска и видны всем пользователям организации или пользователям, которые имеют к ним доступ с помощью разрешения на использование критериев пользователя соответственно. Если статья знаний не включена с пользовательскими критериями, она появится в результатах поиска всех в организации.

ServiceNow Graph Connector поддерживает разрешения пользователей по умолчанию без расширенных скриптов. Когда соединитатель сталкивается с пользовательскими критериями с расширенным скриптом, все данные, использующие эти пользовательские критерии, не отображаются в результатах поиска.

>[!NOTE]
>Чтобы выбрать **только людей с доступом к этому** источнику данных, впустите целевые обновления выпуска на клиента. Подробнее о настройке целевого выпуска см. в выпуске [Setup Targeted release options.](/microsoft-365/admin/manage/release-options-in-office-365?preserve-view=true&view=o365-worldwide)

Если вы **выбираете** только людей с доступом к этому источнику данных, вам необходимо дополнительно выбрать, имеет ли экземпляр ServiceNow Azure Active Directory (AAD) с предварительными пользователями или пользователями, не входив в AAD.

>[!NOTE]
>Если вы выбираете AAD в качестве типа источника удостоверений, убедитесь, что вы назначаете свойству источника UserPrincipalName (UPN) для адресной электронной почты в ServiceNow. Чтобы проверить или изменить сопоставления, см. в приложении [SaaS параметры](/azure/active-directory/app-provisioning/customize-application-attributes)настройки атрибута подготовка пользователей в Azure Active Directory.

Если вы выбрали "non-AAD" для типа удостоверений, см. введите Map [your non-Azure AD Identitys](map-non-aad.md) для инструкций по сопоставлению удостоверений. 

Вы также можете передать следующее видео, чтобы узнать больше об управлении разрешениями на поиск.

[![Управление разрешениями поиска в Microsoft Graph Connector для ServiceNow](https://img.youtube.com/vi/TVSkJpk1RiE/hqdefault.jpg)](https://www.youtube.com/watch?v=TVSkJpk1RiE)

## <a name="step-6-assign-property-labels"></a>Шаг 6. Назначение меток свойств

Следуйте общим инструкциям установки.

## <a name="step-7-manage-schema"></a>Шаг 7. Управление схемой

Следуйте общим инструкциям установки.

## <a name="step-8-choose-refresh-settings"></a>Шаг 8. Выбор параметров обновления

Следуйте общим инструкциям установки.

>[!NOTE]
>Для удостоверений будет применен только запланированный полный обход.

## <a name="step-9-review-connection"></a>Шаг 9. Просмотр подключения

Следуйте общим [инструкциям установки](./configure-connector.md).

Соедините Graph ServiceNow имеет следующие ограничения в своем последнем выпуске:

После публикации подключения необходимо настроить страницу результатов поиска. Подробнее о настройке результатов поиска см. в странице [Настройка страницы результатов поиска.](/microsoftsearch/configure-connector#next-steps-customize-the-search-results-page)

## <a name="limitations"></a>Ограничения
Соедините Graph ServiceNow имеет следующие ограничения в своем последнем выпуске:
- Индексация статей знаний, доступных всем в организации, является обычно доступной функцией.
- *Только люди с доступом к* этой функции источника данных в шаге Управление разрешениями поиска находятся в целевом канале выпуска и обрабатывает только [разрешения на критерии](https://hi.service-now.com/kb_view.do?sysparm_article=KB0550924) пользователя. В результатах поиска не будут применяться разрешения на доступ другого типа.
- Критерии пользователей с расширенными скриптами не поддерживаются в текущей версии. Любые статьи знаний с таким ограничением доступа будут индексироваться с отказом всем пользователям в доступе, то есть они не будут отображаться в результатах поиска любому пользователю до тех пор, пока мы их не поддерживаем.

## <a name="troubleshooting"></a>Устранение неполадок
После публикации подключения, настройки страницы результатов можно просмотреть состояние в вкладке **Источники** данных в центре [администрирования.](https://admin.microsoft.com) Подробнее о том, как делать обновления и удаления, см. в руб. [Управление соединитетелем.](manage-connector.md)
Вы можете найти действия по устранению неполадок для часто замеченных ниже проблем.
### <a name="1-unable-to-login-due-to-single-sign-on-enabled-servicenow-instance"></a>1. Невозможно войти из-за единого Sign-On экземпляра ServiceNow

Если ваша организация включила Sign-On (SSO) в ServiceNow, у вас могут возникнуть проблемы с входом в учетную запись службы. Вы можете привести имя пользователя и пароль <em> `login.do` </em> на основе входа, добавив URL-адрес экземпляра ServiceNow. Эти URL-адреса должны поддерживать протокол HTTPS. `https://<your-organization-domain>.service-now.com./login.do` 

### <a name="2-unauthorized-or-forbidden-response-to-api-request"></a>2. Несанкционированный или запрещенный ответ на запрос API

#### <a name="21-check-table-access-permissions"></a>2.1. Проверка разрешений доступа к таблице
Если вы видите запрещенный или несанкционированный ответ в состоянии подключения, проверьте, имеет ли учетная запись службы необходимый доступ к таблицам, указанным в шаге [3: параметры подключения.](#step-3-connection-settings) Проверьте, есть ли доступ ко всем столбцам в таблицах для чтения.

#### <a name="22-check-if-servicenow-instance-behind-firewall"></a>2.2. Проверьте, есть ли экземпляр ServiceNow за брандмауэром
Graph Соединителу не удастся связаться с экземпляром ServiceNow, если он находится за сетевым брандмауэром. Вам потребуется явно разрешить доступ к службе Graph Соединителю. Диапазон общедоступных IP-адресов Graph Connector Service в таблице ниже. В зависимости от региона клиента добавьте его в белый список сетевых экземпляров ServiceNow.

**Среда** | **Region** | **Range**
--- | --- | ---
PROD | Северная Америка | 52.250.92.252/30, 52.224.250.216/30
PROD | Европа | 20.54.41.208/30, 51.105.159.88/30 
PROD | Азиатско-Тихоокеанский регион | 52.139.188.212/30, 20.43.146.44/30 


Если у вас есть какие-либо другие проблемы или вы хотите предоставить обратную связь, пишите [нам aka.ms/TalkToGraphConnectors](https://aka.ms/TalkToGraphConnectors)
